<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rock The Holidays ROAS Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(229, 231, 235, 1);
        }
        .slider-thumb::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: #ef4444;
            cursor: pointer;
            border-radius: 50%;
        }
        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .loading-shimmer {
            animation: pulse-soft 2s infinite ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-gray-900 pb-20">

    <nav class="bg-white border-b px-6 py-4 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-red-600 rounded flex items-center justify-center text-white font-bold">R</div>
            <h1 class="text-xl font-bold tracking-tight">ROCKIT RIDE <span class="text-red-600">HOLIDAYS</span></h1>
        </div>
        <div class="flex items-center gap-4">
            <div class="hidden md:block text-sm font-medium text-gray-500">Campaign Period: Nov 27 - Dec 30, 2025</div>
            <button id="ai-insight-btn" class="bg-black text-white px-4 py-2 rounded-full text-sm font-bold flex items-center gap-2 hover:bg-gray-800 transition-colors">
                ✨ Generate AI Insights
            </button>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto p-4 lg:p-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Left Column: Controls & Metrics -->
        <div class="lg:col-span-4 space-y-6">
            
            <!-- Summary Stats -->
            <div class="grid grid-cols-2 gap-4">
                <div class="glass-panel p-4 rounded-2xl shadow-sm border-l-4 border-red-500">
                    <p class="text-xs uppercase font-bold text-gray-400 mb-1">Total Ad Spend</p>
                    <p class="text-2xl font-bold" id="stat-spend">$128.12</p>
                </div>
                <div class="glass-panel p-4 rounded-2xl shadow-sm border-l-4 border-green-500">
                    <p class="text-xs uppercase font-bold text-gray-400 mb-1">Total Revenue</p>
                    <p class="text-2xl font-bold" id="stat-revenue">$0.00</p>
                </div>
                <div class="glass-panel p-4 rounded-2xl shadow-sm border-l-4 border-blue-500 col-span-2">
                    <p class="text-xs uppercase font-bold text-gray-400 mb-1">Current ROAS</p>
                    <div class="flex items-baseline gap-2">
                        <p class="text-3xl font-black text-blue-600" id="stat-roas">0.00x</p>
                        <span id="roas-label" class="text-xs font-bold text-blue-400">EXCELLENT</span>
                    </div>
                </div>
            </div>

            <!-- AI Insight Panel (Hidden by default) -->
            <div id="ai-panel" class="hidden glass-panel p-6 rounded-2xl shadow-xl border-2 border-blue-100 bg-blue-50/30 space-y-4">
                <div class="flex justify-between items-center">
                    <h3 class="font-bold text-blue-800 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                        Gemini Strategy Engine
                    </h3>
                    <button id="close-ai" class="text-gray-400 hover:text-gray-600">✕</button>
                </div>
                <div id="ai-content" class="text-sm leading-relaxed text-gray-700 space-y-3">
                    <!-- AI Content will load here -->
                    <div class="loading-shimmer space-y-2">
                        <div class="h-4 bg-blue-100 rounded w-3/4"></div>
                        <div class="h-4 bg-blue-100 rounded w-5/6"></div>
                        <div class="h-4 bg-blue-100 rounded w-1/2"></div>
                    </div>
                </div>
            </div>

            <!-- Interactive Controls -->
            <div class="glass-panel p-6 rounded-2xl shadow-md space-y-8">
                <h3 class="font-bold text-lg flex justify-between items-center">
                    <span>Interactive Parameters</span>
                    <span class="text-[10px] bg-gray-100 px-2 py-0.5 rounded text-gray-500 font-mono italic">Adjust to recalculate</span>
                </h3>

                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-sm font-semibold text-gray-600">Actual Ad Spend ($)</label>
                        <span class="bg-red-50 text-red-700 px-2 py-1 rounded font-mono text-sm" id="val-spend">128.12</span>
                    </div>
                    <input type="range" id="input-spend" min="50" max="500" step="1" value="128.12" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-red-600">
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-sm font-semibold text-gray-600">Ad Attribution (%)</label>
                        <span class="bg-blue-50 text-blue-700 px-2 py-1 rounded font-mono text-sm" id="val-attribution">15%</span>
                    </div>
                    <input type="range" id="input-attribution" min="1" max="100" step="1" value="15" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-sm font-semibold text-gray-600">Avg Life-Time Value ($)</label>
                        <span class="bg-green-50 text-green-700 px-2 py-1 rounded font-mono text-sm" id="val-ltv">$189</span>
                    </div>
                    <input type="range" id="input-ltv" min="50" max="400" step="5" value="189" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-600">
                </div>

                <div class="pt-4 border-t border-dashed">
                    <div class="flex justify-between text-sm font-medium mb-1">
                        <span>New Memberships (Nov-Dec)</span>
                        <span class="font-bold">178</span>
                    </div>
                    <div class="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden">
                        <div id="attr-bar" class="bg-blue-600 h-1.5 rounded-full transition-all duration-500" style="width: 15%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Graphs -->
        <div class="lg:col-span-8 space-y-6">
            
            <!-- Graph 1: ROAS over Spend (Sensitivity Analysis) -->
            <div class="glass-panel p-6 rounded-2xl shadow-sm h-[400px] relative">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="font-bold text-lg leading-tight">ROAS Sensitivity Analysis</h3>
                        <p class="text-sm text-gray-500">Projected return based on spend fluctuations</p>
                    </div>
                    <div class="flex gap-2">
                        <button id="ai-ad-gen-btn" class="text-xs bg-red-50 text-red-600 border border-red-100 px-3 py-1 rounded-full font-bold hover:bg-red-100 transition-colors">
                            ✨ AI Creative Ideas
                        </button>
                    </div>
                </div>
                <canvas id="roasChart"></canvas>
            </div>

            <!-- Bottom Row: Charts & AI Terminal -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass-panel p-6 rounded-2xl shadow-sm h-[300px]">
                    <h3 class="font-bold mb-4">Attributed Revenue</h3>
                    <canvas id="revenueBreakdown"></canvas>
                </div>
                <div class="glass-panel p-6 rounded-2xl shadow-sm flex flex-col justify-center items-center text-center space-y-4">
                    <h3 class="font-bold">Campaign Efficiency</h3>
                    <div class="relative inline-flex items-center justify-center">
                        <svg class="w-32 h-32 transform -rotate-90">
                            <circle cx="64" cy="64" r="58" stroke="currentColor" stroke-width="8" fill="transparent" class="text-gray-200" />
                            <circle id="progress-circle" cx="64" cy="64" r="58" stroke="currentColor" stroke-width="8" fill="transparent" stroke-dasharray="364.4" stroke-dashoffset="100" class="text-red-500 transition-all duration-500" />
                        </svg>
                        <span class="absolute text-2xl font-black" id="percent-label">4.5x</span>
                    </div>
                    <p class="text-xs text-gray-500 px-4" id="efficiency-msg">Based on current attribution settings, your campaign is returning <span class="font-bold text-red-600" id="multiplier-text">4.50</span> dollars for every dollar spent.</p>
                </div>
            </div>

            <!-- Ad Creative Modal -->
            <div id="modal-overlay" class="fixed inset-0 bg-black/50 hidden z-[60] flex items-center justify-center p-4">
                <div class="bg-white rounded-3xl w-full max-w-2xl max-h-[80vh] overflow-y-auto p-8 relative shadow-2xl">
                    <button id="close-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl font-bold">&times;</button>
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center text-red-600">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                        </div>
                        <h2 class="text-2xl font-bold">✨ AI Creative Brainstorm</h2>
                    </div>
                    <div id="modal-content" class="space-y-6">
                         <!-- Loaded via AI -->
                         <div class="animate-pulse space-y-4">
                            <div class="h-4 bg-gray-100 rounded w-full"></div>
                            <div class="h-4 bg-gray-100 rounded w-full"></div>
                            <div class="h-32 bg-gray-50 rounded w-full"></div>
                         </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Constants from Data
        const CAMPAIGN_TOTAL_MEMBERSHIPS = 178; 
        const ACTUAL_SPEND = 128.12;
        const apiKey = ""; // Provided by env

        let roasChart, revenueChart;

        async function callGemini(prompt, systemInstruction = "You are a marketing analytics expert for a fitness studio called Rockit Ride.") {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] }
                    })
                });
                
                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "Unable to generate insights at this time.";
            } catch (error) {
                console.error("Gemini Error:", error);
                return "The strategy engine is currently recharging. Please try again in a moment.";
            }
        }

        function initCharts() {
            const ctx = document.getElementById('roasChart').getContext('2d');
            roasChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Projected ROAS',
                        data: [],
                        borderColor: '#ef4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHitRadius: 20
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'ROAS Multiplier' }, grid: { color: 'rgba(0,0,0,0.05)' } },
                        x: { title: { display: true, text: 'Ad Spend ($)' }, grid: { display: false } }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            const ctxRev = document.getElementById('revenueBreakdown').getContext('2d');
            revenueChart = new Chart(ctxRev, {
                type: 'doughnut',
                data: {
                    labels: ['Attributed Revenue', 'Ad Spend'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#2563eb', '#ef4444'],
                        borderWidth: 8,
                        borderColor: '#ffffff',
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } } }
                }
            });
        }

        function updateCalculations() {
            const spend = parseFloat(document.getElementById('input-spend').value);
            const attributionPercent = parseFloat(document.getElementById('input-attribution').value);
            const attribution = attributionPercent / 100;
            const ltv = parseFloat(document.getElementById('input-ltv').value);

            const attributedMembers = Math.round(CAMPAIGN_TOTAL_MEMBERSHIPS * attribution);
            const totalRevenue = attributedMembers * ltv;
            const roas = spend > 0 ? totalRevenue / spend : 0;

            document.getElementById('val-spend').textContent = spend.toFixed(2);
            document.getElementById('val-attribution').textContent = attributionPercent + '%';
            document.getElementById('val-ltv').textContent = '$' + ltv;
            document.getElementById('attr-bar').style.width = attributionPercent + '%';

            document.getElementById('stat-spend').textContent = '$' + spend.toFixed(2);
            document.getElementById('stat-revenue').textContent = '$' + totalRevenue.toLocaleString();
            document.getElementById('stat-roas').textContent = roas.toFixed(2) + 'x';
            document.getElementById('percent-label').textContent = roas.toFixed(1) + 'x';
            document.getElementById('multiplier-text').textContent = roas.toFixed(2);

            const roasLabel = document.getElementById('roas-label');
            if (roas > 10) { roasLabel.textContent = "LEGENDARY"; roasLabel.className = "text-xs font-bold text-purple-500"; }
            else if (roas > 5) { roasLabel.textContent = "EXCELLENT"; roasLabel.className = "text-xs font-bold text-green-500"; }
            else if (roas > 2) { roasLabel.textContent = "HEALTHY"; roasLabel.className = "text-xs font-bold text-blue-500"; }
            else { roasLabel.textContent = "ROOM TO GROW"; roasLabel.className = "text-xs font-bold text-amber-500"; }

            const circle = document.getElementById('progress-circle');
            const circumference = 364.4;
            const offset = circumference - (Math.min(roas, 10) / 10) * circumference;
            circle.style.strokeDashoffset = offset;
            circle.style.stroke = roas > 5 ? '#22c55e' : roas > 2 ? '#3b82f6' : '#ef4444';

            const labels = [];
            const roasPoints = [];
            for (let i = 50; i <= 500; i += 50) {
                labels.push('$' + i);
                roasPoints.push((totalRevenue / i).toFixed(2));
            }
            roasChart.data.labels = labels;
            roasChart.data.datasets[0].data = roasPoints;
            roasChart.update('none');

            revenueChart.data.datasets[0].data = [totalRevenue, spend];
            revenueChart.update('none');
        }

        // --- AI FEATURES ---

        async function generateAIInsights() {
            const panel = document.getElementById('ai-panel');
            const content = document.getElementById('ai-content');
            panel.classList.remove('hidden');
            content.innerHTML = `<div class="loading-shimmer space-y-2"><div class="h-3 bg-blue-100 rounded w-full"></div><div class="h-3 bg-blue-100 rounded w-5/6"></div><div class="h-3 bg-blue-100 rounded w-2/3"></div></div>`;

            const spend = document.getElementById('stat-spend').textContent;
            const rev = document.getElementById('stat-revenue').textContent;
            const roas = document.getElementById('stat-roas').textContent;
            const attr = document.getElementById('val-attribution').textContent;

            const prompt = `Analyze this campaign data for Rockit Ride (indoor cycling studio):
            Total Ad Spend: ${spend}
            Total Attributed Revenue: ${rev}
            Current ROAS: ${roas}
            Assuming ${attr} of the 178 total memberships were from ads.
            Provide 3 bullet points: 
            1. Evaluation of the campaign efficiency.
            2. One specific 'What-If' advice (e.g. scaling).
            3. A quick summary of the ROI impact.
            Keep it professional but encouraging. Use markdown formatting.`;

            const result = await callGemini(prompt);
            content.innerHTML = result.replace(/\n/g, '<br>');
        }

        async function generateAICreatives() {
            const modal = document.getElementById('modal-overlay');
            const content = document.getElementById('modal-content');
            modal.classList.remove('hidden');
            content.innerHTML = `<div class="loading-shimmer space-y-4"><div class="h-4 bg-gray-100 rounded w-full"></div><div class="h-4 bg-gray-100 rounded w-full"></div><div class="h-4 bg-gray-100 rounded w-3/4"></div><div class="h-32 bg-gray-50 rounded w-full"></div></div>`;

            const prompt = `Based on a holiday campaign that spent $128 and helped drive 178 signups for Rockit Ride (indoor cycling studio), generate 3 fresh ad creative hooks for a 'New Year, New Ride' campaign.
            Format each with:
            - A catchy Headline
            - A short Body text
            - A Visual Suggestion (what should be in the photo/video)
            Make them high-energy and community-focused.`;

            const result = await callGemini(prompt);
            content.innerHTML = `<div class="prose prose-sm text-gray-700">${result.split('\n').map(line => `<p>${line}</p>`).join('')}</div>`;
        }

        // Listeners
        document.querySelectorAll('input[type=range]').forEach(input => {
            input.addEventListener('input', updateCalculations);
        });

        document.getElementById('ai-insight-btn').addEventListener('click', generateAIInsights);
        document.getElementById('ai-ad-gen-btn').addEventListener('click', generateAICreatives);
        document.getElementById('close-ai').addEventListener('click', () => document.getElementById('ai-panel').classList.add('hidden'));
        document.getElementById('close-modal').addEventListener('click', () => document.getElementById('modal-overlay').classList.add('hidden'));

        window.onload = () => {
            initCharts();
            updateCalculations();
        };
    </script>
</body>
</html>
